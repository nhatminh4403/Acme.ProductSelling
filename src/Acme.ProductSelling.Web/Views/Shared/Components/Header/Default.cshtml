@using Acme.ProductSelling.Permissions
@using Acme.ProductSelling.Web.Views.Shared.Components.CategoriesMenu
@using Microsoft.AspNetCore.Authorization

@inject ICurrentUser CurrentUser
@inject IAuthorizationService AuthorizationService

@{
    var hasAdminPermission = await AuthorizationService.IsGrantedAsync(ProductSellingPermissions.Products.Default);
    var title = ViewData["Title"]?.ToString();
    var titleAppName = L["Menu:AppName"].ToString();
    bool checkTitle = title.ToLower().Contains(titleAppName.ToLower());
}


<nav class="modern-header" id="mainHeader">
    <div class="header-container d-flex align-items-center">
        <!-- Logo -->
        <a class="logo-link" href="/" aria-label="Home">
            <img src="~/images/monitor.png" alt="Home" class="logo-img" loading="lazy" />
        </a>

        <!-- Category Button (Desktop) -->
        @if (!checkTitle)
        {
            <button class="category-btn d-none d-lg-flex ms-3" type="button" id="categoryMenuBtn" aria-label="Categories">
                <i class="bi bi-grid-3x3-gap-fill"></i>
                <span>@L["Categories"]</span>
            </button>
        }

        <!-- Search Bar (Desktop) -->
        <div class="search-container d-none d-lg-block">
            <form class="search-form" asp-page="/Products/ProductsByName" method="get">
                <input class="search-input" name="name" type="search" autocomplete="off"
                       placeholder="@L["Search..."]" aria-label="@L["Search..."]">
                <button class="search-btn" type="submit" aria-label="Search">
                    <i class="bi bi-search"></i>
                </button>
            </form>
        </div>

        <!-- Desktop Actions -->
        <div class="header-actions ms-auto d-none d-lg-flex">
            <!-- Hotline -->
            <a href="#" class="hotline-link">
                <span class="hotline-label">@L["UI:Hotline"]</span>
                <span class="hotline-number">0123456789</span>
            </a>

            @if (CurrentUser.IsAuthenticated)
            {
                <!-- User Menu -->
                <div class="user-dropdown" id="userDropdown">
                    <button class="action-btn" type="button">
                        <i class="bi bi-person-circle"></i>
                        <span>@CurrentUser.UserName</span>
                        <i class="bi bi-chevron-down" style="font-size: 0.75rem;"></i>
                    </button>
                    <div class="user-dropdown-menu">
                        <a class="dropdown-item" asp-page="/Account/Manage/Index">
                            <i class="bi bi-person"></i>
                            @L["Account:ManageYourProfile"]
                        </a>
                        <a class="dropdown-item" asp-page="/Orders/OrderHistory">
                            <i class="bi bi-bag"></i>
                            @L["Order:MyOrders"]
                        </a>
                        @if (hasAdminPermission || CurrentUser.IsInRole("Admin") || CurrentUser.IsInRole("admin"))
                        {
                            <a class="dropdown-item" href="@Url.Page("/Admin/Index", new { area = "" })" data-no-culture="true">
                                <i class="bi bi-shield-lock"></i>
                                @L["Admin:Panel"]
                            </a>
                        }
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="/Account/Logout?returnUrl=/" data-no-culture="true">
                            <i class="bi bi-box-arrow-right"></i>
                            @L["Logout"]
                        </a>
                    </div>
                </div>

                <!-- Cart -->
                <a href="/cart" class="cart-btn" aria-label="Cart">
                    <i class="bi bi-cart3 fs-5"></i>
                    <span class="cart-badge d-none" id="cartBadge">0</span>
                </a>
            }
            else
            {
                <!-- Login Dropdown -->
                <div class="login-dropdown" id="loginDropdown">
                    <button class="action-btn primary" type="button">
                        <i class="bi bi-person-fill"></i>
                        <span>@L["Login"]</span>
                        <i class="bi bi-chevron-down" style="font-size: 0.75rem;"></i>
                    </button>
                    <div class="login-dropdown-content">
                        <div class="dropdown-welcome-text">
                            <i class="bi bi-hand-thumbs-up"></i>
                            @L["Login:Welcome"]
                        </div>
                        <div class="dropdown-buttons">
                            <button class="dropdown-btn-login" data-bs-toggle="modal" data-bs-target="#loginModal">
                                @L["Login:Default"]
                            </button>
                            <button class="dropdown-btn-register" data-bs-toggle="modal" data-bs-target="#registerModal">
                                @L["Register:Default"]
                            </button>
                        </div>
                        <a href="#" class="dropdown-help-link">
                            <i class="bi bi-question-circle"></i>
                            @L["Help"]
                        </a>
                    </div>
                </div>
            }
        </div>

        <!-- Mobile Actions -->
        <div class="d-flex d-lg-none ms-auto align-items-center gap-2">
            <button class="mobile-menu-btn" type="button" id="searchToggleBtn">
                <i class="bi bi-search"></i>
            </button>
            @if (CurrentUser.IsAuthenticated)
            {
                <a href="/cart" class="cart-btn" aria-label="Cart">
                    <i class="bi bi-cart3"></i>
                    <span class="cart-badge d-none" id="cartBadgeMobile">0</span>
                </a>
            }
            <button class="mobile-menu-btn" type="button" id="mobileMenuBtn">
                <i class="bi bi-list"></i>
            </button>
        </div>

        <!-- Mobile Search (Collapsible) -->
        <div class="mobile-search d-none">
            <form class="search-form" asp-page="/Products/ProductsByName" method="get">
                <input class="search-input" name="name" type="search" autocomplete="off"
                       placeholder="@L["Search..."]" aria-label="@L["Search..."]">
                <button class="search-btn" type="submit" aria-label="Search">
                    <i class="bi bi-search"></i>
                </button>
            </form>
        </div>
    </div>
</nav>

<!-- Category Megamenu Component -->
@await Component.InvokeAsync(typeof(CategoriesMenuViewComponent))
