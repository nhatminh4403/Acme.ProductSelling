@page "/"
@using Acme.ProductSelling.Web.Pages.Components.Home.HeroSection
@using Acme.ProductSelling.Web.Pages.Components.Home.CategoryList
@using Acme.ProductSelling.Web.Pages.Components.RecentlyViewed
@inject ICurrentUser CurrentUser
@model Acme.ProductSelling.Web.Pages.IndexModel

@section styles {
    <abp-style src="/Pages/Index.css" />
    @* <link href="~/css/shared/products/product-item.css" rel="stylesheet" /> *@
    <link href="~/css/global/products/recently-viewed.css" rel="stylesheet" />

}

@section scripts {
    <abp-script src="/Pages/Index.js" />

    <script>
        RecentlyViewedManager.loadWidget('my-recently-viewed-container');
    </script>
}

@{
    ViewData["Title"] = L["Menu:AppName"];
    Layout = "/Views/Shared/_Layout.cshtml";
}

<div class="container p-0">
    <div class="row">
        <div class="col-md-12 d-flex flex-column gap-1">
            @await Component.InvokeAsync(typeof(HeroSectionViewComponent))

            @if (Model.FeaturedProductCarousels != null && Model.FeaturedProductCarousels.Any())
            {
                foreach (var featuredCategory in Model.FeaturedProductCarousels)
                {
                    if (featuredCategory.Products == null || !featuredCategory.Products.Any())
                    {
                        continue;
                    }

                    var carouselId = $"carousel_{featuredCategory.Category.Id.ToString().Replace("-", "")}";

                    <section class="featured-section">
                        <div class="featured-header">
                            <div class="featured-title-wrapper">
                                <div class="title-accent"></div>

                                <span class="featured-title">
                                    @L["UI:ProductsFromCategory"]
                                        @HelperMethods.GetCategoryLocalizerName(featuredCategory.Category.Name, L)
                                   
                                </span>
                            </div>
                            <a asp-page="/Products/ProductsByCategory"
                               asp-route-slug="@featuredCategory.Category.UrlSlug"
                               class="view-all-btn">
                                @L["SeeAll"]
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M6 3L11 8L6 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </a>
                        </div>

                        <div class="product-carousel-wrapper">
                            <div id="@carouselId" class="product-carousel-container">
                                <button class="carousel-nav carousel-nav-prev" type="button" aria-label="Previous">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                </button>
                                
                                <div class="product-carousel-track">
                                    @foreach (var product in featuredCategory.Products)
                                    {
                                        <div class="product-carousel-item">
                                            <article class="product-card-modern">
                                                <div class="product-image-wrapper">
                                                    <a asp-page="/Products/ProductDetail"
                                                       asp-route-slug="@product.UrlSlug"
                                                       class="product-image-link">
                                                        @if (!string.IsNullOrWhiteSpace(product.ImageUrl))
                                                        {
                                                            <img @*src="@($"https://placehold.co/300x300?text={product.ProductName.Substring(0, 1)}")"*@
                                                                 src="@product.ImageUrl"
                                                                 class="product-image"
                                                                 loading="lazy"
                                                                 alt="@product.ProductName">
                                                        }
                                                        else
                                                        {
                                                            <div class="product-image-placeholder">
                                                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                                                                    <path d="M21 19V5C21 3.9 20.1 3 19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19ZM8.5 13.5L11 16.51L14.5 12L19 18H5L8.5 13.5Z" fill="currentColor" />
                                                                </svg>
                                                            </div>
                                                        }
                                                    </a>

                                                </div>

                                                <div class="product-content">
                                                    <h3 class="product-name">
                                                        <a asp-page="/Products/ProductDetail"
                                                           asp-route-slug="@product.UrlSlug"
                                                           title="@product.ProductName">
                                                            @(product.ProductName.Length > 50 ? product.ProductName.Substring(0, 47) + "..." : product.ProductName)
                                                        </a>
                                                    </h3>
                                                    <div class="product-pricing">
                                                        @if (product.DiscountPercent > 0)
                                                        {
                                                           <span class="price-original">
                                                                    @product.OriginalPrice.ToString("C0", CultureInfo.GetCultureInfo("vi-VN"))
                                                                </span>
                                                            <div class="price-group">
                                                                
                                                                <span class="price-current">
                                                                    @product.DiscountedPrice.Value.ToString("C0", CultureInfo.GetCultureInfo("vi-VN"))
                                                                </span>
                                                                <span class="price-discount-badge">-@product.DiscountPercent%</span>
                                                            </div>
                                                        }
                                                        else
                                                        {
                                                            <span class="price-current">
                                                                @product.OriginalPrice.ToString("C0", CultureInfo.GetCultureInfo("vi-VN"))
                                                            </span>
                                                        }
                                                    </div>

                                                    <a asp-page="/Products/ProductDetail"
                                                       asp-route-slug="@product.UrlSlug"
                                                       class="product-cta">
                                                        <span>@L["ViewDetails"]</span>
                                                        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                            <path d="M6 3L11 8L6 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                                        </svg>
                                                    </a>
                                                </div>
                                            </article>
                                        </div>
                                    }
                                </div>

                                <button class="carousel-nav carousel-nav-next" type="button" aria-label="Next">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                        <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </section>
                }
            }
            else
            {
                <section class="empty-state">
                    <div class="empty-state-content">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
                            <path d="M20 7H4C2.9 7 2 7.9 2 9V18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V9C22 7.9 21.1 7 20 7ZM20 18H4V9H20V18ZM12 4L8 7H16L12 4Z" fill="currentColor" opacity="0.3" />
                        </svg>
                        <h3>@L["Product:NoFeaturedProductsFound"]</h3>
                        <p>Check back soon for exciting new products!</p>
                    </div>
                </section>
            }

            @await Component.InvokeAsync(typeof(CategoryListViewComponent))

            @* @await Component.InvokeAsync(typeof(RecentlyViewedViewComponent), new { maxCount = 6, title = L["UI:RecentlyViewed"].Value, }) *@

        </div>
    </div>
</div>