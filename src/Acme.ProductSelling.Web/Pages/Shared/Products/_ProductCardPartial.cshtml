@using System.Globalization
@using Microsoft.AspNetCore.Mvc.Localization
@using Acme.ProductSelling.Localization
@using Microsoft.Extensions.Localization;

@inject IStringLocalizer<ProductSellingResource> L

@model Acme.ProductSelling.Products.ProductDto


<div class="card product-card h-100">
    @if (Model.DiscountPercent > 0)
    {
        <div class="product-badge">-@Model.DiscountPercent%</div>
    }

    <a asp-page="/Products/ProductDetail" asp-route-slug="@Model.UrlSlug" class="product-image-link">
        @* Tạm thời dùng placeholder nếu ảnh lỗi, bạn có thể thay bằng logic của HelperMethods *@
        <img src="@Model.ImageUrl"
             class="card-img-top"
             loading="lazy"
             alt="@Model.ProductName"
             onerror="this.onerror=null;this.src='https://placehold.co/200x200/FFFFFF/CCCCCC?text=Image+Not+Found';">
    </a>

    <div class="card-body d-flex flex-column p-2">
        <h6 class="product-title flex-grow-1">
            <a asp-page="/Products/ProductDetail" asp-route-slug="@Model.UrlSlug" title="@Model.ProductName">
                @* Cắt chuỗi nếu tên quá dài để tránh vỡ layout *@
                @(Model.ProductName.Length > 55 ? Model.ProductName.Substring(0, 52) + "..." : Model.ProductName)
            </a>
        </h6>

        <div class="product-price-wrapper mt-auto">
            @if (Model.DiscountPercent > 0 && Model.DiscountedPrice.HasValue)
            {
                <span class="product-price-old">@Model.OriginalPrice.ToString("C0", CultureInfo.GetCultureInfo("vi-VN"))</span>
                <span class="product-price-current">@Model.DiscountedPrice.Value.ToString("C0", CultureInfo.GetCultureInfo("vi-VN"))</span>
            }
            else
            {
                <span class="product-price-current">@Model.OriginalPrice.ToString("C0", CultureInfo.GetCultureInfo("vi-VN"))</span>
            }
        </div>
    </div>

    <div class="card-footer p-2 text-center">
        @* Có thể thêm nút "Thêm vào giỏ" ở đây trong tương lai *@
        <a asp-page="/Products/ProductDetail" asp-route-slug="@Model.UrlSlug" class="btn btn-sm btn-primary w-100">
            <i class="bi bi-search me-1"></i> @L["ViewDetails"]
        </a>
    </div>
</div>