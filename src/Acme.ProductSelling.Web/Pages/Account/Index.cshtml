@page "/account"
@model Acme.ProductSelling.Web.Pages.Account.IndexModel
@{
    Layout = "/Views/Shared/_Layout.cshtml"; 
    ViewData["Title"] = L["ManageAccount"];
}

@section styles {
    <link href="~/css/global/user/account.css" rel="stylesheet" />
}

<div class="account-management-container">
    <!-- Header -->
    <div class="account-header">
        <h1><i class="fas fa-user-circle"></i> @L["ManageAccount"]</h1>
        <p>@L["ManageAccountDescription"]</p>
    </div>

    <!-- Tabs Navigation -->
    <div class="tabs-container">
        <ul class="custom-tabs">
            <li>
                <button type="button" class="tab-button active" data-tab="profile">
                    <i class="fas fa-user"></i>
                    <span>@L["ProfileInformation"]</span>
                </button>
            </li>
            <li>
                <button type="button" class="tab-button" data-tab="security">
                    <i class="fas fa-lock"></i>
                    <span>@L["Security"]</span>
                </button>
            </li>
            <li>
                <button type="button" class="tab-button" data-tab="addresses">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>@L["Addresses"]</span>
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tabs-content">
            <!-- Profile Tab -->
            <div id="profile-tab" class="tab-content active">
                <form method="post" asp-page-handler="UpdateProfile" id="profile-form">
                    <div class="info-card">
                        <i class="fas fa-info-circle"></i>
                        <span>@L["ProfileInfoDescription"]</span>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="fas fa-id-card"></i>
                            @L["BasicInformation"]
                        </h3>
                        <div class="form-grid">
                            <abp-input asp-for="ProfileInput.UserName" />
                            <abp-input asp-for="ProfileInput.Email" />
                            <abp-input asp-for="ProfileInput.Name" />
                            <abp-input asp-for="ProfileInput.Surname" />
                            <abp-input asp-for="ProfileInput.PhoneNumber" />
                            <abp-input asp-for="ProfileInput.DateOfBirth" />
                        </div>
                    </div>


                    <div class="form-actions">
                        <abp-button button-type="Secondary" type="button" onclick="resetForm('profile-form')">
                            <i class="fas fa-undo"></i> @L["Reset"]
                        </abp-button>
                        <abp-button button-type="Primary" type="submit" busy-text="@L["Saving"]">
                            <i class="fas fa-save"></i> @L["SaveChanges"]
                        </abp-button>
                    </div>
                </form>
            </div>

            <!-- Security Tab -->
            <div id="security-tab" class="tab-content">
                <form method="post" asp-page-handler="ChangePassword" id="password-form">
                    <div class="info-card">
                        <i class="fas fa-shield-alt"></i>
                        <span>@L["SecurityDescription"]</span>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="fas fa-key"></i>
                            @L["ChangePassword"]
                        </h3>
                        <div class="form-grid">
                            <div>
                                <abp-input asp-for="PasswordInput.CurrentPassword" />
                            </div>
                            <div>
                                <abp-input asp-for="PasswordInput.NewPassword" />
                                <div class="password-strength">
                                    <div class="strength-bar">
                                        <div class="strength-bar-fill" id="password-strength-bar"></div>
                                    </div>
                                    <small id="password-strength-text" class="text-muted"></small>
                                </div>
                            </div>
                            <div>
                                <abp-input asp-for="PasswordInput.ConfirmPassword" />
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <abp-button button-type="Secondary" type="button" onclick="resetForm('password-form')">
                            <i class="fas fa-undo"></i> @L["Reset"]
                        </abp-button>
                        <abp-button button-type="Primary" type="submit" busy-text="@L["Changing"]">
                            <i class="fas fa-lock"></i> @L["ChangePassword"]
                        </abp-button>
                    </div>
                </form>
            </div>

            <!-- Addresses Tab -->
            <div id="addresses-tab" class="tab-content">
                <form method="post" asp-page-handler="UpdateProfile" id="address-form">
                    <div class="info-card">
                        <i class="fas fa-truck"></i>
                        <span>@L["AddressInfoDescription"]</span>
                    </div>

                    <div class="form-section">
                        <h3 class="form-section-title">
                            <i class="fas fa-shipping-fast"></i>
                            @L["ShippingAddress"]
                        </h3>
                        <abp-input asp-for="ProfileInput.ShippingAddress" />
                    </div>

                   

                    <div class="form-actions">
                        <abp-button button-type="Secondary" type="button" onclick="resetForm('address-form')">
                            <i class="fas fa-undo"></i> @L["Reset"]
                        </abp-button>
                        <abp-button button-type="Primary" type="submit" busy-text="@L["Saving"]">
                            <i class="fas fa-save"></i> @L["SaveChanges"]
                        </abp-button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        $(document).ready(function() {
            // Tab switching functionality
            $('.tab-button').on('click', function() {
                const tabName = $(this).data('tab');

                // Update active states
                $('.tab-button').removeClass('active');
                $(this).addClass('active');

                $('.tab-content').removeClass('active');
                $(`#${tabName}-tab`).addClass('active');

                // Update URL hash without reload
                history.pushState(null, null, `#${tabName}`);
            });

            // Handle initial hash
            const hash = window.location.hash.substring(1);
            if (hash) {
                $(`.tab-button[data-tab="${hash}"]`).click();
            }

            // Password strength indicator
            $('input[name="PasswordInput.NewPassword"]').on('input', function() {
                const password = $(this).val();
                const strength = calculatePasswordStrength(password);
                updatePasswordStrength(strength);
            });

            // Same as shipping checkbox
            $('#sameAsShipping').on('change', function() {
                if ($(this).is(':checked')) {
                    const shippingAddress = $('textarea[name="ProfileInput.ShippingAddress"]').val();
                    $('textarea[name="ProfileInput.BillingAddress"]').val(shippingAddress);
                }
            });
        });

        function calculatePasswordStrength(password) {
            let strength = 0;

            if (password.length >= 8) strength++;
            if (password.length >= 12) strength++;
            if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength++;
            if (/\d/.test(password)) strength++;
            if (/[^a-zA-Z0-9]/.test(password)) strength++;

            return strength;
        }

        function updatePasswordStrength(strength) {
            const bar = $('#password-strength-bar');
            const text = $('#password-strength-text');

            bar.removeClass('strength-weak strength-medium strength-strong');

            if (strength <= 2) {
                bar.css('width', '33%').addClass('strength-weak');
                text.text('@L["PasswordStrengthWeak"]').css('color', '#dc3545');
            } else if (strength <= 4) {
                bar.css('width', '66%').addClass('strength-medium');
                text.text('@L["PasswordStrengthMedium"]').css('color', '#ffc107');
            } else {
                bar.css('width', '100%').addClass('strength-strong');
                text.text('@L["PasswordStrengthStrong"]').css('color', '#28a745');
            }
        }

        function resetForm(formId) {
            $(`#${formId}`)[0].reset();
            $('#password-strength-bar').css('width', '0');
            $('#password-strength-text').text('');
        }
    </script>
}